<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>탱크 재고 현황 (복붙 자동)</title>
  <style>
    :root{
      --red:#d60000;
      --blue:#006dff;
      --purple:#7b3fe4;
      --green:#00a651;
      --black:#111;
      --zero:#ffd6de;
      --line:#111;
      --font: system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo","Noto Sans KR", Arial, sans-serif;
    }
    body{ font-family:var(--font); margin:16px; color:#111; background:#fff; }
    h1{ margin:0 0 10px; font-size:22px; }
    .hint{ font-size:12px; color:#444; line-height:1.45; margin:0 0 10px; }
    textarea{
      width:100%; min-height:170px; padding:10px;
      border:1px solid #cfcfcf; border-radius:10px; font-size:13px;
      box-sizing:border-box; outline:none; white-space:pre;
    }
    .bar{ display:flex; gap:8px; margin:10px 0 12px; flex-wrap:wrap; }
    button{
      border:1px solid #111; background:#111; color:#fff;
      padding:9px 12px; border-radius:10px; font-weight:900; cursor:pointer;
    }
    button.secondary{ background:#fff; color:#111; }

    .layout{
      display:grid;
      grid-template-columns: 1.6fr 0.7fr;
      gap:12px;
      align-items:start;
    }
    @media (max-width: 1100px){
      .layout{ grid-template-columns: 1fr; }
    }

    .panel{
      border:2px solid var(--line);
      border-radius:12px;
      background:#fff;
      padding:10px;
      overflow:auto;
    }

    /* SVG는 원본 규격 유지 + 화면에 맞게 스케일 */
    .svg-wrap{ min-width: 980px; }
    svg{ width:100%; height:auto; display:block; }

    /* 오른쪽 표 */
    .side h2{ margin:0 0 10px; font-size:16px; }
    table{ width:100%; border-collapse:collapse; font-size:12px; }
    th,td{ border:1px solid #ddd; padding:6px 7px; vertical-align:top; }
    th{ background:#f5f5f5; text-align:left; }
    .muted{ color:#666; font-size:12px; margin-top:8px; line-height:1.4; }
  </style>
</head>

<body>
  <h1>탱크 재고 현황 (복붙 자동)</h1>
  <div class="hint">
    1) 엑셀 표를 그대로 복사해서 아래에 붙여넣기<br/>
    2) <b>현황표 업데이트</b> 클릭<br/>
    - 표 헤더 매핑: <b>Tank=B열(SILO/TANK번호)</b>, <b>재고량(T)=F열÷1000</b>, <b>제품명=D열</b><br/>
    - <b>ETC_3(말분)</b>은 무시 / <b>Br1~Br12</b>는 이름만 표시<br/>
  </div>

  <textarea id="paste" placeholder="여기에 엑셀 표를 그대로 붙여넣으세요 (탭/공백 섞여도 OK)"></textarea>
  <div class="bar">
    <button id="btnMap">현황표 업데이트</button>
    <button class="secondary" id="btnClear">초기화</button>
    <button class="secondary" id="btnDemo">데모</button>
  </div>

  <div class="layout">
    <!-- MAP -->
    <div class="panel svg-wrap">
      <svg viewBox="0 0 1000 430" aria-label="Tank Map">
        <!-- 외곽 -->
        <rect x="5" y="5" width="990" height="420" fill="#fff" stroke="var(--line)" stroke-width="2"/>

        <!-- 상단 안내문 -->
        <text x="150" y="25" fill="var(--red)" font-size="14" font-weight="900" text-anchor="middle">
          Packaging Bin : 40M/T x 24Q'ty = 960M/T
        </text>
        <text x="150" y="45" fill="var(--red)" font-size="14" font-weight="900" text-anchor="middle">
          70M/T x 6Q'ty = 420M/T
        </text>
        <text x="170" y="65" fill="var(--blue)" font-size="14" font-weight="900" text-anchor="middle">
          Bulk Loding Bin : 70M/T x 6Q'ty = 420M/T
        </text>

        <!-- 구역 텍스트 -->
        <text x="390" y="150" fill="#111" font-size="34" font-weight="500" text-anchor="middle">Milling Area (New)</text>
        <text x="730" y="150" fill="#111" font-size="34" font-weight="500" text-anchor="middle">Milling Area (Old)</text>

        <text x="500" y="260" fill="var(--purple)" font-size="14" font-weight="900" text-anchor="middle">
          Semi-finished Bin : 30M/T x 6Q'ty = 180M/T
        </text>

        <text x="625" y="292" fill="var(--green)" font-size="14" font-weight="900" text-anchor="middle">
          Premix Bin : 30M/T x 4Q'ty = 120M/T
        </text>

        <text x="800" y="260" fill="#111" font-size="14" font-weight="900" text-anchor="middle">
          Bran byproduct Bin : 30M/T x 8Q'ty = 240M/T
        </text>

        <text x="600" y="410" fill="var(--blue)" font-size="14" font-weight="900" text-anchor="middle">
          Bulk Loding Bin : 40M/T x 12Q'ty + 80M/T x 8Q'ty = 1600M/T
        </text>

        <!-- OFFICE -->
        <text x="25" y="370" fill="#111" font-size="18" font-weight="900" writing-mode="tb" glyph-orientation-vertical="0">OFFICE</text>

        <!-- ===== 공통 스타일(원/텍스트) : class 대신 data로 제어 ===== -->
        <defs>
          <g id="tankCircle">
            <circle r="22" fill="#fff" stroke="var(--line)" stroke-width="2"></circle>
          </g>
        </defs>

        <!-- ===== Bran (ETC_2) ===== -->
        <g data-tank="Bran" transform="translate(950,55)">
          <use href="#tankCircle"></use>
          <circle r="22" fill="transparent" stroke="var(--black)" stroke-width="2"></circle>
          <text data-name y="-2" text-anchor="middle" font-size="13" font-weight="900" fill="#111">Bran</text>
          <text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="#111">—</text>
          <text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="#111">—</text>
        </g>

        <!-- ===== RED : A / P ===== -->
        <!-- 좌표는 원본 그림 기준으로 고정 (규격 불일치 방지) -->
        <!-- row1 -->
        <g data-tank="A6"  transform="translate(60,95)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">A6</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="A5"  transform="translate(110,95)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">A5</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="3P8" transform="translate(160,95)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">3P8</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="3P7" transform="translate(210,95)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">3P7</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="2P8" transform="translate(260,95)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">2P8</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="2P7" transform="translate(310,95)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">2P7</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="1P8" transform="translate(360,95)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">1P8</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="1P7" transform="translate(410,95)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">1P7</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>

        <!-- row2 -->
        <g data-tank="A4"  transform="translate(60,145)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">A4</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="A3"  transform="translate(110,145)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">A3</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="3P6" transform="translate(160,145)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">3P6</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="3P5" transform="translate(210,145)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">3P5</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="2P6" transform="translate(260,145)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">2P6</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="2P5" transform="translate(310,145)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">2P5</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="1P6" transform="translate(360,145)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">1P6</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="1P5" transform="translate(410,145)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">1P5</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>

        <!-- row3 -->
        <g data-tank="A2"  transform="translate(60,195)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">A2</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="A1"  transform="translate(110,195)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">A1</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="3P4" transform="translate(160,195)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">3P4</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="3P3" transform="translate(210,195)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">3P3</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="2P4" transform="translate(260,195)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">2P4</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="2P3" transform="translate(310,195)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">2P3</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="1P4" transform="translate(360,195)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">1P4</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="1P3" transform="translate(410,195)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">1P3</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>

        <!-- row4(6개) -->
        <g data-tank="3P2" transform="translate(185,245)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">3P2</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="3P1" transform="translate(235,245)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">3P1</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="2P2" transform="translate(285,245)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">2P2</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="2P1" transform="translate(335,245)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">2P1</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="1P2" transform="translate(385,245)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">1P2</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>
        <g data-tank="1P1" transform="translate(435,245)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--red)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">1P1</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--red)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--red)">—</text></g>

        <!-- ===== BLUE : T1~T6 ===== -->
        <g data-tank="T6" transform="translate(230,290)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">T6</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="T5" transform="translate(280,290)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">T5</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="T4" transform="translate(330,290)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">T4</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="T3" transform="translate(380,290)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">T3</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="T2" transform="translate(430,290)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">T2</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="T1" transform="translate(480,290)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">T1</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>

        <!-- ===== PURPLE : L1~L6 ===== -->
        <g data-tank="L1" transform="translate(350,335)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--purple)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--purple)">L1</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--purple)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--purple)">—</text></g>
        <g data-tank="L2" transform="translate(400,335)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--purple)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--purple)">L2</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--purple)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--purple)">—</text></g>
        <g data-tank="L3" transform="translate(450,335)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--purple)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--purple)">L3</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--purple)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--purple)">—</text></g>
        <g data-tank="L4" transform="translate(500,335)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--purple)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--purple)">L4</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--purple)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--purple)">—</text></g>
        <g data-tank="L5" transform="translate(550,335)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--purple)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--purple)">L5</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--purple)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--purple)">—</text></g>
        <g data-tank="L6" transform="translate(600,335)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--purple)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--purple)">L6</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--purple)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--purple)">—</text></g>

        <!-- ===== GREEN : B1~B4 ===== -->
        <g data-tank="B4" transform="translate(650,300)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--green)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--green)">B4</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--green)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--green)">—</text></g>
        <g data-tank="B1" transform="translate(700,300)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--green)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--green)">B1</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--green)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--green)">—</text></g>
        <g data-tank="B3" transform="translate(650,350)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--green)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--green)">B3</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--green)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--green)">—</text></g>
        <g data-tank="B2" transform="translate(700,350)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--green)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--green)">B2</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--green)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--green)">—</text></g>

        <!-- ===== Br5~Br12 : 사각형(이름만) ===== -->
        <!-- (도면처럼 8개 가로) -->
        <g>
          <rect x="730" y="285" width="40" height="34" fill="#fff" stroke="var(--line)" stroke-width="2"/><text x="750" y="306" text-anchor="middle" font-size="12" font-weight="900">Br12</text>
          <rect x="770" y="285" width="40" height="34" fill="#fff" stroke="var(--line)" stroke-width="2"/><text x="790" y="306" text-anchor="middle" font-size="12" font-weight="900">Br11</text>
          <rect x="810" y="285" width="40" height="34" fill="#fff" stroke="var(--line)" stroke-width="2"/><text x="830" y="306" text-anchor="middle" font-size="12" font-weight="900">Br10</text>
          <rect x="850" y="285" width="40" height="34" fill="#fff" stroke="var(--line)" stroke-width="2"/><text x="870" y="306" text-anchor="middle" font-size="12" font-weight="900">Br9</text>
          <rect x="890" y="285" width="40" height="34" fill="#fff" stroke="var(--line)" stroke-width="2"/><text x="910" y="306" text-anchor="middle" font-size="12" font-weight="900">Br8</text>
          <rect x="930" y="285" width="40" height="34" fill="#fff" stroke="var(--line)" stroke-width="2"/><text x="950" y="306" text-anchor="middle" font-size="12" font-weight="900">Br7</text>
          <rect x="970" y="285" width="40" height="34" fill="#fff" stroke="var(--line)" stroke-width="2"/><text x="990" y="306" text-anchor="middle" font-size="12" font-weight="900">Br6</text>
          <rect x="1010" y="285" width="40" height="34" fill="#fff" stroke="var(--line)" stroke-width="2"/><text x="1030" y="306" text-anchor="middle" font-size="12" font-weight="900">Br5</text>
        </g>

        <!-- ===== Br1~Br4 : 오른쪽 세로(이름만) ===== -->
        <g>
          <rect x="915" y="300" width="60" height="32" fill="#fff" stroke="var(--line)" stroke-width="2"/><text x="945" y="320" text-anchor="middle" font-size="12" font-weight="900">Br4</text>
          <rect x="915" y="332" width="60" height="32" fill="#fff" stroke="var(--line)" stroke-width="2"/><text x="945" y="352" text-anchor="middle" font-size="12" font-weight="900">Br3</text>
          <rect x="915" y="364" width="60" height="32" fill="#fff" stroke="var(--line)" stroke-width="2"/><text x="945" y="384" text-anchor="middle" font-size="12" font-weight="900">Br2</text>
          <rect x="915" y="396" width="60" height="32" fill="#fff" stroke="var(--line)" stroke-width="2"/><text x="945" y="416" text-anchor="middle" font-size="12" font-weight="900">Br1</text>
        </g>

        <!-- ===== BLUE : L15~L26 / L7~L14 ===== -->
        <!-- 윗줄 -->
        <g data-tank="L15" transform="translate(360,360)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L15</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="L16" transform="translate(410,360)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L16</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="L17" transform="translate(460,360)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L17</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="L18" transform="translate(510,360)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L18</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="L19" transform="translate(560,360)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L19</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="L20" transform="translate(610,360)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L20</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="L8"  transform="translate(660,360)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L8</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="L7"  transform="translate(710,360)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L7</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>

        <!-- 아랫줄 -->
        <g data-tank="L21" transform="translate(360,410)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L21</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="L22" transform="translate(410,410)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L22</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="L23" transform="translate(460,410)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L23</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="L24" transform="translate(510,410)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L24</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="L25" transform="translate(560,410)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L25</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="L26" transform="translate(610,410)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L26</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>

        <!-- L9~L14 (오른쪽 2열) -->
        <g data-tank="L10" transform="translate(700,410)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L10</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="L9"  transform="translate(750,410)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L9</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>

        <g data-tank="L12" transform="translate(700,460)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L12</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="L11" transform="translate(750,460)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L11</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>

        <g data-tank="L14" transform="translate(700,510)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L14</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>
        <g data-tank="L13" transform="translate(750,510)"><use href="#tankCircle"/><circle r="22" fill="transparent" stroke="var(--blue)" stroke-width="2"/><text y="-2" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">L13</text><text data-qty y="14" text-anchor="middle" font-size="12" font-weight="900" fill="var(--blue)">—</text><text data-pct y="28" text-anchor="middle" font-size="10" font-weight="900" fill="var(--blue)">—</text></g>

      </svg>
    </div>

    <!-- SIDE TABLE -->
    <div class="panel side">
      <h2>탱크별 상세 (제품명 포함)</h2>
      <table>
        <thead>
          <tr>
            <th>Tank</th>
            <th>재고량(T)</th>
            <th>제품명</th>
          </tr>
        </thead>
        <tbody id="tbody">
          <tr><td colspan="3" style="color:#666;">붙여넣기 후 업데이트를 누르면 채워집니다.</td></tr>
        </tbody>
      </table>
      <div class="muted">
        - <b>Tank</b> = 엑셀 <b>B열(SILO/TANK번호)</b> → 도면 탱크명으로 매핑<br/>
        - <b>재고량(T)</b> = 엑셀 <b>F열</b>을 <b>÷1000</b><br/>
        - <b>제품명</b> = 엑셀 <b>D열</b><br/>
        - <b>ETC_3(말분)</b>은 제외 / <b>Br1~Br12</b>는 데이터가 없어 표에 미표시
      </div>
    </div>
  </div>

<script>
  // ====== 탱크ID(B열) → 도면 탱크명 ======
  const MAP = new Map(Object.entries({
    "ETC_2":"Bran",
    "ETC_3":"말분",

    "FBL_B1":"B1","FBL_B2":"B2","FBL_B3":"B3","FBL_B4":"B4",
    "FBL_L1":"L1","FBL_L2":"L2","FBL_L3":"L3","FBL_L4":"L4","FBL_L5":"L5","FBL_L6":"L6",
    "FBL_L7":"L7","FBL_L8":"L8","FBL_L9":"L9","FBL_L10":"L10","FBL_L11":"L11","FBL_L12":"L12","FBL_L13":"L13",
    "FBL_L15":"L15","FBL_L16":"L16","FBL_L17":"L17","FBL_L18":"L18","FBL_L19":"L19",
    "FBL_L20":"L20","FBL_L21":"L21","FBL_L22":"L22","FBL_L23":"L23","FBL_L24":"L24","FBL_L25":"L25","FBL_L26":"L26",

    "FPP_1P1":"1P1","FPP_1P2":"1P2","FPP_1P3":"1P3","FPP_1P4":"1P4",
    "FPP_1P5":"1P5","FPP_1P6":"1P6","FPP_1P7":"1P7","FPP_1P8":"1P8",
    "FPP_2P1":"2P1","FPP_2P2":"2P2","FPP_2P3":"2P3","FPP_2P4":"2P4",
    "FPP_2P5":"2P5","FPP_2P6":"2P6","FPP_2P7":"2P7","FPP_2P8":"2P8",
    "FPP_3P1":"3P1","FPP_3P2":"3P2","FPP_3P3":"3P3","FPP_3P4":"3P4",
    "FPP_3P5":"3P5","FPP_3P6":"3P6","FPP_3P7":"3P7","FPP_3P8":"3P8",
    "FPP_A1":"A1","FPP_A2":"A2","FPP_A3":"A3","FPP_A4":"A4","FPP_A5":"A5","FPP_A6":"A6",
    "FPP_T1":"T1","FPP_T2":"T2","FPP_T3":"T3","FPP_T4":"T4","FPP_T5":"T5","FPP_T6":"T6",
  }));

  // ====== 도면 용량(T) ======
  function capT(name){
    if (name === "Bran") return 400;
    if (/^A[1-6]$/.test(name)) return 70;
    if (/^[123]P[1-8]$/.test(name)) return 40;
    if (/^T[1-6]$/.test(name)) return 70;
    if (/^L[1-6]$/.test(name)) return 30;
    if (/^B[1-4]$/.test(name)) return 30;

    if (/^L(15|16|17|18)$/.test(name)) return 60;
    if (/^L(19|20|25|26)$/.test(name)) return 40;
    if (/^L(21|22|23|24)$/.test(name)) return 60;
    if (/^L(7|8|9|10|11|12|13|14)$/.test(name)) return 80;

    return null;
  }

  // ====== 유틸 ======
  function numFromToken(s){
    const v = Number(String(s).replaceAll(",","").replaceAll(" ","").replaceAll("\t","").replace(/[^0-9.]/g,""));
    return Number.isFinite(v) ? v : null;
  }
  function kgToT(kg){ return kg/1000; }
  function fmtT(t){
    if (t === null) return "—";
    const isInt = Math.abs(t - Math.round(t)) < 1e-9;
    return isInt ? `${Math.round(t).toLocaleString("en-US")}t`
                 : `${t.toLocaleString("en-US",{maximumFractionDigits:1})}t`;
  }
  function fmtPct(t, cap){
    if (t === null || cap === null || cap === 0) return "—";
    return `${Math.round((t/cap)*100)}%`;
  }

  // ====== 핵심: 어떤 붙여넣기 형태든 "B열 탱크ID"를 찾아서 파싱 ======
  // - 탭이 있으면 탭 기준 우선
  // - 탭이 없으면 공백 다중 분리
  // - 라인에서 FBL_ / FPP_ / ETC_2 / ETC_3 를 찾고
  // - 마지막 숫자 토큰을 재고량으로 인식
  // - 제품명은 "제품코드(숫자)" 다음부터 "재고단위(KG/대)" 직전까지 합치기
  const tankIdRe = /\b(ETC_2|ETC_3|FBL_[A-Z0-9]+|FPP_[A-Z0-9]+)\b/;

  function parse(text){
    const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
    const rows = []; // {tankRaw, tankName, kg, productName}

    for(const line of lines){
      // 헤더/매핑표(2열) 제거
      if (line.includes("재고구분") && line.includes("SILO/TANK")) continue;

      // 탱크ID가 없는 줄은 스킵 (매핑표/잡텍스트)
      const m = line.match(tankIdRe);
      if(!m) continue;

      const tankRaw = m[1];
      if (tankRaw === "ETC_3") continue; // 말분 무시

      const cols = line.includes("\t") ? line.split("\t").map(s=>s.trim()).filter(Boolean)
                                       : line.split(/\s+/).map(s=>s.trim()).filter(Boolean);

      // 재고량(F열) = 마지막 숫자
      let qty = null;
      for(let i=cols.length-1; i>=0; i--){
        const n = numFromToken(cols[i]);
        if(n !== null){ qty = n; break; }
      }
      if(qty === null) continue;

      // 제품명(D열) 추정: 제품코드(숫자 9~12자리) 다음부터 "KG/대" 전까지
      let idxCode = -1;
      for(let i=0; i<cols.length; i++){
        if (/^\d{9,12}$/.test(cols[i])) { idxCode = i; break; }
      }
      let idxUnit = -1;
      for(let i=0; i<cols.length; i++){
        if (cols[i] === "KG" || cols[i] === "대") { idxUnit = i; break; }
      }

      let productName = "";
      if(idxCode !== -1 && idxUnit !== -1 && idxUnit > idxCode+1){
        productName = cols.slice(idxCode+1, idxUnit).join(" ");
      } else {
        // fallback: 탱크ID 뒤에서 숫자/단위 앞까지 최대한
        productName = "";
      }

      const tankName = MAP.get(tankRaw);
      if(!tankName || tankName === "말분") continue;

      rows.push({ tankRaw, tankName, kg: qty, productName });
    }
    return rows;
  }

  function resetUI(){
    document.querySelectorAll("[data-tank]").forEach(g=>{
      g.querySelector("[data-qty]").textContent = "—";
      g.querySelector("[data-pct]").textContent = "—";
      g.querySelector("circle").setAttribute("fill","#fff");
    });
    const tbody = document.getElementById("tbody");
    tbody.innerHTML = `<tr><td colspan="3" style="color:#666;">붙여넣기 후 업데이트를 누르면 채워집니다.</td></tr>`;
  }

  function update(text){
    const rows = parse(text);

    // 탱크별 합산
    const agg = new Map(); // tankName -> {kgSum, products:Set}
    for(const r of rows){
      const prev = agg.get(r.tankName) || {kgSum:0, products:new Set()};
      prev.kgSum += r.kg;
      if(r.productName) prev.products.add(r.productName);
      agg.set(r.tankName, prev);
    }

    // SVG 탱크 업데이트 (도면에 있는 탱크만)
    document.querySelectorAll("[data-tank]").forEach(g=>{
      const name = g.getAttribute("data-tank");
      const d = agg.get(name);
      const t = d ? kgToT(d.kgSum) : null;
      const cap = capT(name);

      g.querySelector("[data-qty]").textContent = fmtT(t);
      g.querySelector("[data-pct]").textContent = cap ? `(${fmtPct(t,cap)})` : "—";

      // 0이면 배경 강조
      const isZero = (t !== null && Math.abs(t) < 1e-9);
      g.querySelector("circle").setAttribute("fill", isZero ? "var(--zero)" : "#fff");
    });

    // 오른쪽 표 채우기
    const tbody = document.getElementById("tbody");
    tbody.innerHTML = "";

    const keys = Array.from(agg.keys()).sort((a,b)=>a.localeCompare(b,"en",{numeric:true}));
    if(keys.length === 0){
      tbody.innerHTML = `<tr><td colspan="3" style="color:#666;">매핑 가능한 탱크 데이터가 없습니다.</td></tr>`;
      return;
    }

    for(const tankName of keys){
      const d = agg.get(tankName);
      const t = kgToT(d.kgSum);
      const products = Array.from(d.products).join("<br/>") || "";
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><b>${tankName}</b></td>
        <td>${fmtT(t)}</td>
        <td>${products}</td>
      `;
      tbody.appendChild(tr);
    }
  }

  document.getElementById("btnMap").addEventListener("click", ()=> update(document.getElementById("paste").value || ""));
  document.getElementById("btnClear").addEventListener("click", ()=>{
    document.getElementById("paste").value = "";
    resetUI();
  });

  document.getElementById("btnDemo").addEventListener("click", ()=>{
    document.getElementById("paste").value =
`재고구분\tSILO/TANK번호\t제품코드\t제품명\t재고단위\t재고량
반제품 Bulk 탱크\tETC_2\t101100000391\t소맥피_350KG\t대\t320,000.
반제품 Bulk 탱크\tFBL_B2\t101200000054\t코끼리_빵용_BULK\tKG\t25,000.
반제품 Bulk 탱크\tFBL_L19\t101200000043\t소맥분8호_BULK\tKG\t36,000.
포장 Bulk 탱크\tFPP_3P8\t101200000075\t박력2급_BULK\tKG\t36,000.
포장 Bulk 탱크\tFPP_T6\t101200000097\t오티밀가루2호_BULK\tKG\t75,000.
포장 Bulk 탱크\tFPP_A6\t101200000053\t사료전용분_BULK\tKG\t40,000.`;
  });

  resetUI();
</script>
</body>
</html>
