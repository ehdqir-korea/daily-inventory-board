<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>일일재고현황표</title>
  <style>
    :root{
      --line:#111;
      --blue:#1f5cff;
      --orange:#cc6a00;
      --green:#7aa63a;
      --zero:#ffd6de;
    }
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo", "Noto Sans KR", Arial, sans-serif;
      margin: 24px;
      color:#111;
    }
    .top{
      display:flex;
      gap:16px;
      align-items:flex-end;
      flex-wrap:wrap;
    }
    .title{
      flex:1;
      text-align:center;
      font-size:40px;
      font-weight:800;
      letter-spacing:10px;
      margin: 18px 0 22px;
    }
    .hint{
      font-size:14px;
      line-height:1.4;
      margin: 10px 0 8px;
      color:#333;
    }
    textarea{
      width:100%;
      min-height:140px;
      padding:12px;
      font-size:14px;
      border:1px solid #ccc;
      border-radius:10px;
      outline:none;
    }
    .actions{
      display:flex;
      gap:10px;
      margin-top:10px;
      flex-wrap:wrap;
    }
    button{
      border:1px solid #222;
      background:#111;
      color:#fff;
      padding:10px 14px;
      border-radius:10px;
      cursor:pointer;
      font-weight:700;
    }
    button.secondary{
      background:#fff;
      color:#111;
    }
    .wrap{
      margin-top:22px;
      display:flex;
      justify-content:center;
    }

    /* ===== 도면 영역 ===== */
    .board{
      position:relative;
      width: 980px;
      max-width: 100%;
      aspect-ratio: 7 / 3;   /* 보기 좋게 */
      border: 2px solid var(--line);
      padding: 26px 26px 30px;
      box-sizing:border-box;
    }

    /* 7칸 × 2줄 = 사각형 14개 */
    .rect-grid{
      position:absolute;
      left: 70px;
      right: 70px;
      top: 90px;
      bottom: 65px;
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      grid-template-rows: repeat(2, 1fr);
      border:2px solid var(--line);
      box-sizing:border-box;
    }
    .rect{
      border:1px solid var(--line);
      background:#fff;
    }

    /* 원 6×3 = 18개 (격자 교차점 중앙 배치 느낌) */
    .circles-layer{
      position:absolute;
      left: 70px;
      right: 70px;
      top: 90px;
      bottom: 65px;
      pointer-events:none;
    }

    .circle{
      position:absolute;
      width: 120px;
      height: 120px;
      border:2px solid var(--line);
      border-radius:999px;
      background:#fff;
      transform: translate(-50%, -50%);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:6px;
      box-sizing:border-box;
      text-align:center;
      padding-top:4px;
    }
    .circle.zero{
      background: var(--zero);
    }
    .code{
      font-weight:900;
      font-size:24px;
      line-height:1;
      color: var(--blue);
    }
    .code.orange{
      color: var(--orange);
    }
    .qty{
      font-weight:900;
      font-size:22px;
      line-height:1;
    }
    .loc{
      font-weight:800;
      font-size:20px;
      line-height:1;
      color: var(--green);
    }

    .footer-note{
      margin-top:14px;
      font-size:13px;
      color:#444;
      line-height:1.5;
    }
    .mini{
      font-size:12px;
      color:#666;
    }
    .legend{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-top:10px;
      font-size:13px;
      color:#333;
      align-items:center;
    }
    .pill{
      border:1px solid #ccc;
      padding:4px 8px;
      border-radius:999px;
      background:#fafafa;
    }
    .pill b{ font-weight:900; }
  </style>
</head>
<body>

  <div class="top">
    <div>
      <div class="hint">
        ✅ 엑셀에서 표 영역을 **복사**한 뒤 아래 입력칸에 **붙여넣기** → **[자동 매핑]** 클릭<br/>
        <span class="mini">※ 붙여넣기 텍스트 안에 <b>코드(WASW 등) → 수량(숫자) → 위치(A101 등)</b> 패턴이 있으면 자동 인식합니다.</span>
      </div>
      <textarea id="paste" placeholder="여기에 엑셀에서 복사한 내용을 그대로 붙여넣으세요. (Ctrl+V)"></textarea>
      <div class="actions">
        <button id="btnMap">자동 매핑</button>
        <button class="secondary" id="btnClear">초기화</button>
        <button class="secondary" id="btnDemo">데모 채우기</button>
      </div>
      <div class="legend">
        <span class="pill"><b style="color:var(--orange)">WCRS/WUR/WNS</b>는 주황색</span>
        <span class="pill"><b style="background:var(--zero); padding:2px 6px; border-radius:6px;">수량 0</b> 배경 강조</span>
        <span class="pill">수량은 자동 <b>콤마</b></span>
      </div>
    </div>
  </div>

  <div class="title">일 일 재 고 현 황 표</div>

  <div class="wrap">
    <div class="board" aria-label="일일재고현황 도면">
      <!-- 7x2 사각형 -->
      <div class="rect-grid" id="rectGrid"></div>

      <!-- 6x3 원 -->
      <div class="circles-layer" id="circlesLayer"></div>
    </div>
  </div>

  <div class="footer-note">
    <b>복붙 데이터 팁</b><br/>
    - 가장 잘 되는 형태: 엑셀에 <b>[코드] [수량] [위치]</b> 3열로 18행 정리 후 복사<br/>
    - 그래도 현재 예시처럼 복잡한 표를 통째로 붙여넣어도, 본 페이지는 텍스트에서 <b>코드→수량→A코드</b>를 순서대로 찾아 매핑합니다.
  </div>

<script>
  // ===== 설정 =====
  const ORANGE_CODES = new Set(["WCRS", "WUR", "WNS"]);
  const circleCols = 6; // 6개 가로
  const circleRows = 3; // 3개 세로
  const totalCircles = circleCols * circleRows; // 18
  const fmt = new Intl.NumberFormat("en-US");

  // 도면 구성(사각형 14개)
  const rectGrid = document.getElementById("rectGrid");
  for(let i=0;i<14;i++){
    const d = document.createElement("div");
    d.className = "rect";
    rectGrid.appendChild(d);
  }

  // 원 생성 + 배치
  const circlesLayer = document.getElementById("circlesLayer");
  const circles = [];
  for(let r=0; r<circleRows; r++){
    for(let c=0; c<circleCols; c++){
      const idx = r*circleCols + c;

      const el = document.createElement("div");
      el.className = "circle";
      el.dataset.idx = String(idx);

      const codeEl = document.createElement("div");
      codeEl.className = "code";
      codeEl.textContent = "—";

      const qtyEl = document.createElement("div");
      qtyEl.className = "qty";
      qtyEl.textContent = "—";

      const locEl = document.createElement("div");
      locEl.className = "loc";
      locEl.textContent = "—";

      el.appendChild(codeEl);
      el.appendChild(qtyEl);
      el.appendChild(locEl);

      // "교차점 중앙" 느낌: 가장자리까지 포함해 균등 분포(0%~100%)
      const x = (circleCols === 1) ? 50 : (c/(circleCols-1))*100;
      const y = (circleRows === 1) ? 50 : (r/(circleRows-1))*100;
      el.style.left = x + "%";
      el.style.top  = y + "%";

      circlesLayer.appendChild(el);
      circles.push({el, codeEl, qtyEl, locEl});
    }
  }

  function setCircle(i, code, qty, loc){
    const item = circles[i];
    if(!item) return;

    // 코드 색
    item.codeEl.textContent = code ?? "—";
    item.codeEl.classList.toggle("orange", ORANGE_CODES.has(String(code || "").trim()));

    // 수량 표시(콤마)
    const n = Number(String(qty).replaceAll(",", "").trim());
    const isNum = Number.isFinite(n);

    item.qtyEl.textContent = isNum ? fmt.format(n) : (qty ?? "—");

    // 0이면 배경 강조
    item.el.classList.toggle("zero", isNum && n === 0);

    // 위치
    item.locEl.textContent = loc ?? "—";
  }

  function resetAll(){
    for(let i=0;i<totalCircles;i++){
      setCircle(i, "—", "—", "—");
      circles[i].el.classList.remove("zero");
      circles[i].codeEl.classList.remove("orange");
    }
  }

  // 붙여넣기 텍스트에서 (CODE)(QTY)(A###) 패턴을 순서대로 뽑기
  function parseTriples(text){
    // CODE: 영문+숫자/점 포함(예: WUSL9.0)
    const tokenRe = /([A-Z]{2,10}[A-Z0-9.]*?)|(\d{1,3}(?:,\d{3})*|\d+)|\b(A\d{3})\b/g;
    const tokens = [];
    let m;
    while((m = tokenRe.exec(text)) !== null){
      const t = m[0];
      tokens.push(t);
    }

    // tokens에서 code → qty → A### 순서로 묶기
    const triples = [];
    let i=0;
    while(i < tokens.length && triples.length < totalCircles){
      // code 찾기
      while(i < tokens.length && !/^[A-Z]{2,10}[A-Z0-9.]*$/.test(tokens[i])) i++;
      if(i >= tokens.length) break;
      const code = tokens[i++];

      // qty 찾기
      while(i < tokens.length && !/^\d{1,3}(?:,\d{3})*$|^\d+$/.test(tokens[i])) i++;
      if(i >= tokens.length) break;
      const qty = tokens[i++];

      // loc 찾기
      while(i < tokens.length && !/^A\d{3}$/.test(tokens[i])) i++;
      if(i >= tokens.length) break;
      const loc = tokens[i++];

      triples.push({code, qty, loc});
    }
    return triples;
  }

  document.getElementById("btnMap").addEventListener("click", () => {
    const text = document.getElementById("paste").value || "";
    const triples = parseTriples(text);

    resetAll();

    // 인식된 만큼 순서대로 채우기
    for(let i=0;i<triples.length;i++){
      setCircle(i, triples[i].code, triples[i].qty, triples[i].loc);
    }

    if(triples.length < totalCircles){
      alert(`인식된 항목: ${triples.length}개 / 18개\n붙여넣기 텍스트에 '코드→수량→A###' 패턴이 충분히 있는지 확인해 주세요.`);
    }
  });

  document.getElementById("btnClear").addEventListener("click", () => {
    document.getElementById("paste").value = "";
    resetAll();
  });

  document.getElementById("btnDemo").addEventListener("click", () => {
    const demo = `
WASW 1508 A101
WCRS 1671 A102
WASW 1754 A103
WASWP 1496 A104
WUR 1494 A105
WNS 1686 A106
WNS 152 A201
WUSH 420 A202
WASW 398 A203
WCRS 420 A204
WASW 401 A205
WCRS 243 A206
WNS 170 A207
WUSH 1367 A301
WUR 1516 A302
WASW 1615 A303
WASW 0 A304
WASW 1653 A305
`;
    document.getElementById("paste").value = demo.trim();
  });

  // 초기 상태
  resetAll();
</script>
</body>
</html>
