<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>일일재고현황표</title>
  <style>
    :root{
      --line:#111;
      --blue:#1f5cff;
      --orange:#cc6a00;
      --green:#7aa63a;
      --zero:#ffd6de;

      /* ===== 모양 튜닝(필요시 이 3개만 조절) ===== */
      --cellH: 120px;      /* 사각형 1칸 높이(도면 느낌) */
      --circleD: 120px;    /* 원 지름 */
      --padTop: 18px;      /* 도면 위 여백(원 잘림 방지) */
    }

    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo","Noto Sans KR", Arial, sans-serif;
      margin: 20px;
      color:#111;
    }

    .bar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-bottom:10px;
    }
    textarea{
      width:100%;
      min-height:140px;
      padding:12px;
      font-size:14px;
      border:1px solid #ccc;
      border-radius:10px;
      outline:none;
      box-sizing:border-box;
      white-space:pre-wrap;
    }
    button{
      border:1px solid #222;
      background:#111;
      color:#fff;
      padding:10px 14px;
      border-radius:10px;
      cursor:pointer;
      font-weight:900;
    }
    button.secondary{
      background:#fff;
      color:#111;
    }
    .legend{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin:10px 0 8px;
      font-size:13px;
      color:#333;
    }
    .pill{
      border:1px solid #ccc;
      padding:4px 8px;
      border-radius:999px;
      background:#fafafa;
    }

    .title{
      text-align:center;
      font-size:44px;
      font-weight:900;
      letter-spacing:14px;
      margin:18px 0 14px;
    }

    /* ===== 도면(고정 구조) ===== */
    .wrap{
      display:flex;
      justify-content:center;
      margin-top:6px;
    }
    .board{
      width: 980px;
      max-width: 100%;
      border:2px solid var(--line);
      padding: 18px 18px 22px;
      box-sizing:border-box;
      background:#fff;
    }

    .stage{
      position:relative;
      padding-top: var(--padTop);
    }

    /* 7칸 x 2줄 */
    .grid{
      position:relative;
      width: 100%;
      height: calc(var(--cellH) * 2);
      border:2px solid var(--line);
      box-sizing:border-box;
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      grid-template-rows: repeat(2, 1fr);
      overflow: visible;
    }
    .cell{
      border:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:center;
      background:#fff;
      position:relative;
      z-index:1;
    }

    /* 사각형 안 텍스트(겹침 방지: line-height 고정) */
    .box{
      text-align:center;
      line-height:1.05;
      transform: translateY(2px);
    }
    .t-code{
      font-weight:900;
      font-size:20px;
      color:var(--blue);
      letter-spacing:0.5px;
    }
    .t-code.orange{ color:var(--orange); }
    .t-qty{
      font-weight:900;
      font-size:20px;
      margin-top:4px;
      color:#000;
    }
    .t-loc{
      font-weight:900;
      font-size:18px;
      margin-top:6px;
      color:var(--green);
    }
    .cell.zero{ background:var(--zero); }

    /* ===== 원 6x3 (교차점 중앙) =====
       교차점 = 세로선 1~6 / 가로선 0,1,2
       x = (1..6)/7
       y = (0..2)/2
    */
    .circles{
      position:absolute;
      left:0;
      top:0;
      width:100%;
      height: calc(var(--cellH) * 2 + var(--padTop));
      pointer-events:none;
      z-index:3;
      overflow: visible;
    }
    .circle{
      position:absolute;
      width: var(--circleD);
      height: var(--circleD);
      border:2px solid var(--line);
      border-radius:999px;
      background:#fff;
      transform: translate(-50%, -50%);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      gap:6px;
      box-sizing:border-box;
      line-height:1.05;
    }
    .circle.zero{ background:var(--zero); }
    .c-code{
      font-weight:900;
      font-size:24px;
      color:var(--blue);
      letter-spacing:0.5px;
    }
    .c-code.orange{ color:var(--orange); }
    .c-qty{
      font-weight:900;
      font-size:22px;
      color:#000;
    }
    .c-loc{
      font-weight:900;
      font-size:20px;
      color:var(--green);
    }

    .note{
      margin-top:12px;
      font-size:13px;
      color:#444;
      line-height:1.55;
    }
    .note b{ font-weight:900; }
  </style>
</head>
<body>

  <div class="note">
    <b>사용법</b><br/>
    1) 엑셀에서 표를 복사(Ctrl+C) → 아래 칸에 붙여넣기(Ctrl+V)<br/>
    2) <b>현황표 업데이트</b> 클릭<br/>
    ※ 이 페이지는 붙여넣은 텍스트에서 <b>“코드 → 수량 → A###”</b> 패턴을 찾아 <b>A코드 기준</b>으로 자동 배치합니다.
  </div>

  <textarea id="paste" placeholder="여기에 엑셀에서 복사한 내용을 그대로 붙여넣으세요."></textarea>

  <div class="bar">
    <button id="btnMap">현황표 업데이트</button>
    <button class="secondary" id="btnClear">초기화</button>
    <button class="secondary" id="btnDemo">데모</button>
  </div>

  <div class="legend">
    <span class="pill"><b style="color:var(--orange)">WCRS/WUR/WNS</b> → 주황색</span>
    <span class="pill"><b style="background:var(--zero); padding:2px 6px; border-radius:6px;">수량 0</b> → 배경 강조</span>
    <span class="pill">수량 자동 <b>콤마</b></span>
  </div>

  <div class="title">일 일 재 고 현 황 표</div>

  <div class="wrap">
    <div class="board">
      <div class="stage">
        <div class="grid" id="grid">
          <div class="circles" id="circles"></div>
          <!-- 14 cells appended by JS -->
        </div>
      </div>
    </div>
  </div>

<script>
  const ORANGE = new Set(["WCRS","WUR","WNS"]);
  const fmt = new Intl.NumberFormat("en-US");

  // 원 위치(A1/A3/A5)
  const CIRCLE_LOCS = [
    "A101","A102","A103","A104","A105","A106",
    "A301","A302","A303","A304","A305","A306",
    "A501","A502","A503","A504","A505","A506",
  ];

  // 사각형 위치(A2/A4)
  const RECT_TOP = ["A201","A202","A203","A204","A205","A206","A207"];
  const RECT_BOT = ["A401","A402","A403","A404","A405","A406","A407"];

  const grid = document.getElementById("grid");
  const circlesLayer = document.getElementById("circles");

  // ===== 사각형 14개 생성 =====
  const rectCells = [];
  function makeCell(){
    const cell = document.createElement("div");
    cell.className = "cell";
    const box = document.createElement("div");
    box.className = "box";

    const code = document.createElement("div");
    code.className = "t-
